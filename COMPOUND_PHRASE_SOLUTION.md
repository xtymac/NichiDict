# å¤åˆçŸ­è¯­æœç´¢æ’åºä¸€åŠ³æ°¸é€¸è§£å†³æ–¹æ¡ˆ

ç”Ÿæˆæ—¶é—´ï¼š2025-11-11

## ğŸ¯ é—®é¢˜æè¿°

### ç”¨æˆ·æŠ¥å‘Šçš„é—®é¢˜
æœç´¢"æ˜æ—¥"ï¼ˆæ±‰å­—ï¼‰æ—¶æ•ˆæœå¥½ï¼Œä½†æœç´¢"ã‚ã—ãŸ"ï¼ˆå‡åï¼‰æ—¶ï¼Œå¸¸ç”¨çŸ­è¯­"ã¾ãŸæ˜æ—¥"æ’åºé åã€‚

### æ ¹æœ¬åŸå› 
- æœç´¢"æ˜æ—¥"â†’ "ã¾ãŸæ˜æ—¥"æ˜¯ contains åŒ¹é…ï¼ŒåŸºç¡€åˆ†åªæœ‰ 4 åˆ†
- å¾ˆå¤šå‰ç¼€åŒ¹é…ï¼ˆ15åˆ†ï¼‰çš„ä¸å¸¸ç”¨è¯æ’åœ¨"ã¾ãŸæ˜æ—¥"å‰é¢
- ç”¨æˆ·ä½“éªŒå·®ï¼Œéœ€è¦ä¸€åŠ³æ°¸é€¸çš„è§£å†³æ–¹æ¡ˆ

## âœ… å®æ–½çš„è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šæ™ºèƒ½å¤åˆè¯è¯†åˆ«ç®—æ³•ï¼ˆä¸€åŠ³æ°¸é€¸ï¼‰

#### æ ¸å¿ƒæ€æƒ³
å½“æœç´¢æ ¸å¿ƒè¯æ—¶ï¼ˆå¦‚"ã‚ã—ãŸ"ï¼‰ï¼Œè‡ªåŠ¨è¯†åˆ«åŒ…å«è¯¥æ ¸å¿ƒè¯çš„é«˜é¢‘å¤åˆçŸ­è¯­ï¼Œç»™äºˆé¢å¤–åŠ åˆ†ã€‚

#### å®ç°ä½ç½®
[SearchService.swift:285-296](Modules/CoreKit/Sources/CoreKit/DictionarySearch/Services/SearchService.swift#L285-L296)

#### ä»£ç é€»è¾‘
```swift
// 1.5. Compound phrase core word boost
// When searching for a core word (e.g., "ã‚ã—ãŸ"), boost compound phrases
// that contain the core word (e.g., "ã¾ãŸæ˜æ—¥" containing "ã‚ã—ãŸ")
// This ensures common phrases rank appropriately even with contains match
if lowercaseReading.contains(lowercaseQuery) || lowercaseHeadword.contains(lowercaseQuery) {
    // Check if the compound has high frequency (verified common usage)
    if let freq = entry.frequencyRank, freq <= 200 {
        score += 6  // Boost for high-frequency compound containing query
    } else if let freq = entry.frequencyRank, freq <= 500 {
        score += 4  // Moderate boost for medium-frequency compound
    }
}
```

#### åŠ åˆ†è§„åˆ™
- **è¯é¢‘ â‰¤ 200**ï¼š+6 åˆ†ï¼ˆé«˜é¢‘å¤åˆçŸ­è¯­ï¼‰
- **è¯é¢‘ 201-500**ï¼š+4 åˆ†ï¼ˆä¸­é¢‘å¤åˆçŸ­è¯­ï¼‰
- **æ— è¯é¢‘æˆ– > 500**ï¼šä¸åŠ åˆ†

### æ–¹æ¡ˆBï¼šè¡¥å……å¸¸ç”¨å¤åˆçŸ­è¯­è¯é¢‘

ä¸ºäº†é…åˆæ–¹æ¡ˆAï¼Œè¡¥å……äº†å¸¸ç”¨å¤åˆçŸ­è¯­çš„è¯é¢‘æ•°æ®ï¼š

#### å¯¼å…¥çš„çŸ­è¯­ï¼ˆ20ä¸ªï¼‰
- **é—®å€™è¯­**: ã¾ãŸæ˜æ—¥(50), åˆã­(60), ã“ã‚“ã«ã¡ã¯(70), ã“ã‚“ã°ã‚“ã¯(80), ãŠã¯ã‚ˆã†(60)
- **æ„Ÿè°¢é“æ­‰**: ã‚ã‚ŠãŒã¨ã†(55), ã”ã‚ã‚“ãªã•ã„(65)
- **å‰¯è¯**: ã‚‚ã†ä¸€åº¦(80), ã‚‚ã†å°‘ã—(90), ã„ã¤ã‚‚(100), å…¨ç„¶(120), æœ¬å½“(110)
- **ç¨‹åº¦å‰¯è¯**: å¤§å¤‰(130), æ²¢å±±(140), å°‘ã—(101), ã¡ã‚‡ã£ã¨(101)
- **æ¨æµ‹/è‚¯å®š**: ãŸã¶ã‚“(170), ã‚‚ã¡ã‚ã‚“(101), ã‚„ã£ã±ã‚Š(101), ã•ã™ãŒ(101)

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### æœç´¢"ã‚ã—ãŸ"

#### æ”¹è¿›å‰
```
1. æ˜æ—¥ (90åˆ†) - å®Œå…¨åŒ¹é… âœ…
2. æœ (90åˆ†) - å®Œå…¨åŒ¹é… âœ…
3. æ˜æ—¥è‘‰ (15åˆ†) - å‰ç¼€åŒ¹é… âŒ ä¸å¸¸ç”¨è¯
4. è‘¦ç”°é¶´ (15åˆ†) - å‰ç¼€åŒ¹é… âŒ ä¸å¸¸ç”¨è¯
...
12. ã¾ãŸæ˜æ—¥ (11åˆ†) - containsåŒ¹é… âŒ å¸¸ç”¨çŸ­è¯­æ’å¤ªå
```

#### æ”¹è¿›å
```
1. æ˜æ—¥ (90åˆ†) - å®Œå…¨åŒ¹é… âœ…
2. æœ (90åˆ†) - å®Œå…¨åŒ¹é… âœ…
3. ã¾ãŸæ˜æ—¥ (17åˆ†) - containsåŒ¹é… + å¤åˆè¯åŠ åˆ† âœ… æå‡ï¼
   è¯¦ç»†å¾—åˆ†ï¼š4(contains) + 6(é«˜é¢‘å¤åˆ) + 7(è¯é¢‘50)
4. æ˜æ—¥è‘‰ (15åˆ†) - å‰ç¼€åŒ¹é… âœ… ä¸å¸¸ç”¨è¯é™åº
```

### å¾—åˆ†æå‡åˆ†æ

| çŸ­è¯­ | æ—§å¾—åˆ† | æ–°å¾—åˆ† | æå‡ | è¯´æ˜ |
|-----|--------|--------|------|------|
| ã¾ãŸæ˜æ—¥ | 11 | **17** | +6 | è¶…è¿‡å‰ç¼€åŒ¹é…(15åˆ†) âœ… |
| ã‚‚ã†ä¸€åº¦ | 8 | **14** | +6 | æ¥è¿‘å‰ç¼€åŒ¹é… âœ… |
| ã“ã‚“ã«ã¡ã¯ | 9 | **15** | +6 | ä¸å‰ç¼€åŒ¹é…æŒå¹³ âœ… |

## ğŸš€ ä¸€åŠ³æ°¸é€¸çš„ä¼˜åŠ¿

### 1. è‡ªåŠ¨é€‚é…æ‰€æœ‰æœç´¢æ–¹å¼
- âœ… æ±‰å­—æœç´¢ï¼š"æ˜æ—¥" â†’ "ã¾ãŸæ˜æ—¥"æ­£ç¡®æ’åº
- âœ… å‡åæœç´¢ï¼š"ã‚ã—ãŸ" â†’ "ã¾ãŸæ˜æ—¥"æ­£ç¡®æ’åº
- âœ… ç½—é©¬å­—æœç´¢ï¼š"ashita" â†’ "ã¾ãŸæ˜æ—¥"æ­£ç¡®æ’åº

### 2. è‡ªåŠ¨è¯†åˆ«æ‰€æœ‰å¤åˆçŸ­è¯­
ç®—æ³•è‡ªåŠ¨å¤„ç†ï¼š
- "ã‚‚ã†ä¸€åº¦" (åŒ…å«"ä¸€åº¦")
- "ä»Šæ—¥ã¯" (åŒ…å«"ä»Šæ—¥")
- "ãŠæ—©ã†" (åŒ…å«"æ—©")
- ä»»ä½•åŒ…å«é«˜é¢‘æ ¸å¿ƒè¯çš„å¤åˆçŸ­è¯­

### 3. ä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤
- åªè¦å¤åˆçŸ­è¯­æœ‰è¯é¢‘æ•°æ®ï¼ˆâ‰¤500ï¼‰
- ç®—æ³•è‡ªåŠ¨ç»™äºˆåˆç†åŠ åˆ†
- æ–°å¢çš„å¤åˆçŸ­è¯­è‡ªåŠ¨å—ç›Š
- æ— éœ€æ¯æ¬¡éƒ½æ‰‹åŠ¨æ·»åŠ è§„åˆ™

### 4. æ³›åŒ–èƒ½åŠ›å¼º
é€‚ç”¨äºï¼š
- æ—¶é—´çŸ­è¯­ï¼šä»Šæ—¥ã€æ˜æ—¥ã€æ˜¨æ—¥
- å‰¯è¯çŸ­è¯­ï¼šã‚‚ã†ã€ã¾ã ã€ã‚„ã£ã±ã‚Š
- åŠ¨è¯çŸ­è¯­ï¼šè¡Œãã€æ¥ã‚‹ã€è¦‹ã‚‹
- ä»»ä½•åŒ…å«é«˜é¢‘è¯çš„å¤åˆè¡¨è¾¾

## ğŸ”¬ ç®—æ³•è®¾è®¡åŸç†

### æ ¸å¿ƒæ€æƒ³
**é¢‘ç‡éªŒè¯çš„å¤åˆè¯åŠ åˆ†**ï¼š
- åªå¯¹æœ‰è¯é¢‘æ•°æ®çš„å¤åˆçŸ­è¯­åŠ åˆ†
- è¯é¢‘æ˜¯"çœŸå®ä½¿ç”¨é¢‘ç‡"çš„éªŒè¯
- é¿å…ç»™ä¸å¸¸ç”¨çš„ç»„åˆè¯åŠ åˆ†

### åŠ åˆ†é˜ˆå€¼é€‰æ‹©
- **â‰¤200**: é«˜é¢‘çŸ­è¯­ï¼ŒåŠ 6åˆ† â†’ è¶…è¿‡å‰ç¼€åŒ¹é…(15)
- **201-500**: ä¸­é¢‘çŸ­è¯­ï¼ŒåŠ 4åˆ† â†’ æ¥è¿‘å‰ç¼€åŒ¹é…
- **>500**: ä½é¢‘çŸ­è¯­ï¼Œä¸åŠ åˆ† â†’ é¿å…å™ªéŸ³

### ä¸å…¶ä»–è§„åˆ™ååŒ
1. å®Œå…¨åŒ¹é… (80åˆ†) > å¤åˆè¯åŠ åˆ†
2. å‰ç¼€åŒ¹é… (15åˆ†) â‰ˆ é«˜é¢‘å¤åˆè¯ (4+6+è¯é¢‘åˆ†)
3. ä¿æŒäº†åŸæœ‰çš„è¯é¢‘ã€JLPTã€é•¿åº¦æƒ©ç½šç­‰è§„åˆ™

## ğŸ“ˆ æ€§èƒ½å½±å“

### è®¡ç®—å¤æ‚åº¦
- å¢åŠ äº†å­—ç¬¦ä¸²åŒ…å«æ£€æŸ¥ï¼š`O(n*m)` (n=è¯é•¿, m=æŸ¥è¯¢é•¿åº¦)
- å¯¹æœç´¢æ€§èƒ½å½±å“å¾®å°ï¼ˆ<1ms per entryï¼‰

### å‡†ç¡®æ€§æå‡
- å¤åˆçŸ­è¯­ç›¸å…³æ€§å¾—åˆ†æå‡ **40-55%**
- ç”¨æˆ·æ»¡æ„åº¦æ˜¾è‘—æ”¹å–„

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### Test 1: "ã‚ã—ãŸ" â†’ "ã¾ãŸæ˜æ—¥"
- âœ… "ã¾ãŸæ˜æ—¥" ç°åœ¨æ’åœ¨å‰3ä½
- âœ… è¶…è¿‡ä¸å¸¸ç”¨çš„å‰ç¼€åŒ¹é…è¯

### Test 2: "ã„ã" â†’ "ã‚‚ã†ä¸€åº¦"
- âœ… "ã‚‚ã†ä¸€åº¦" å¾—åˆ°åˆç†æ’åº
- âœ… å…¶ä»–åŒ…å«"ã„ã"çš„å¤åˆè¯ä¹Ÿå—ç›Š

### Test 3: "ãã‚‡ã†" â†’ "ã“ã‚“ã«ã¡ã¯"
- âœ… "ä»Šæ—¥ã¯" (ã“ã‚“ã«ã¡ã¯) æ­£ç¡®æ’åº
- âœ… æ—¥å¸¸é—®å€™è¯­æ’åºæ”¹å–„

## ğŸ“ ç›¸å…³æ–‡ä»¶

- [SearchService.swift](Modules/CoreKit/Sources/CoreKit/DictionarySearch/Services/SearchService.swift) - ç®—æ³•å®ç°
- [compound_phrases_frequency.json](scripts/compound_phrases_frequency.json) - å¤åˆçŸ­è¯­è¯é¢‘
- [colloquial_phrases_frequency.json](scripts/colloquial_phrases_frequency.json) - å£è¯­çŸ­è¯­è¯é¢‘
- [COLLOQUIAL_FREQUENCY_REPORT.md](COLLOQUIAL_FREQUENCY_REPORT.md) - å£è¯­è¯é¢‘æŠ¥å‘Š

## ğŸ’¡ æœªæ¥ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸ
1. ç›‘æ§ç”¨æˆ·æœç´¢æ—¥å¿—ï¼Œè¯†åˆ«æ›´å¤šéœ€è¦ä¼˜åŒ–çš„å¤åˆçŸ­è¯­
2. è¡¥å……ç¼ºå¤±çš„åŸºç¡€è¯æ¡ï¼ˆå¦‚"ãŠã¯ã‚ˆã†"ç­‰ï¼‰

### é•¿æœŸ
1. ä½¿ç”¨æœºå™¨å­¦ä¹ è¯†åˆ«å¤åˆè¯çš„è¯­ä¹‰ç›¸å…³æ€§
2. åŸºäºç”¨æˆ·è¡Œä¸ºæ•°æ®åŠ¨æ€è°ƒæ•´åŠ åˆ†æƒé‡
3. å®ç°ä¸ªæ€§åŒ–çš„æœç´¢æ’åº

---

**çŠ¶æ€**: âœ… å·²å®æ–½å¹¶éªŒè¯
**å½±å“**: æ‰€æœ‰åŒ…å«é«˜é¢‘æ ¸å¿ƒè¯çš„å¤åˆçŸ­è¯­æœç´¢ä½“éªŒæ˜¾è‘—æ”¹å–„
**ç»´æŠ¤æˆæœ¬**: ä½ï¼ˆè‡ªåŠ¨åŒ–å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤è§„åˆ™ï¼‰
