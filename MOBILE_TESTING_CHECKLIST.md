# 📱 NichiDict 真机测试清单

## 测试环境准备

### 设备要求
- [ ] iPhone 已连接到 Mac
- [ ] 已在 Xcode 中选择真机设备
- [ ] 已信任开发者证书（设置 → 通用 → VPN与设备管理）
- [ ] 已启用开发者模式（设置 → 隐私与安全性 → 开发者模式）

### 测试前准备
- [ ] 使用 Debug 菜单清除 AI 缓存
- [ ] 确认网络连接正常
- [ ] 确认 API Key 已配置

---

## 一、多语言支持测试

### 1.1 中文系统测试
**系统语言**：设置 → 通用 → 语言与地区 → 简体中文

#### 测试用例 1：搜索"お金が足りません"
- [ ] UI 标签显示为中文
  - [ ] "Translation" 显示为 "翻译"
  - [ ] "Word Breakdown" 显示为 "逐词解析"
  - [ ] "Grammar Points" 显示为 "语法点"
  - [ ] "Examples" 显示为 "用例"
- [ ] AI 返回内容为中文
  - [ ] wordBreakdown 的 meaning 是中文（如 "钱"）
  - [ ] grammaticalRole 是中文（如 "名詞"）
  - [ ] grammarPoints 的 explanation 是中文
- [ ] 翻译显示格式
  - [ ] 主翻译：`中：钱不够。`
  - [ ] 次要翻译：`EN：I don't have enough money.`

#### 测试用例 2：搜索"食べる"
- [ ] 显示本地词典结果
- [ ] 词性标签为中文（如 "动词"）
- [ ] 定义优先显示中文
- [ ] 例句翻译显示为：`中：我吃早饭。`

### 1.2 英文系统测试
**系统语言**：Settings → General → Language & Region → English

#### 测试用例 3：搜索"お金が足りません"
- [ ] UI 标签显示为英文
  - [ ] "Translation"
  - [ ] "Word Breakdown"
  - [ ] "Grammar Points"
  - [ ] "Examples"
- [ ] AI 返回内容为英文
  - [ ] wordBreakdown 的 meaning 是英文（如 "money"）
  - [ ] grammaticalRole 是英文（如 "noun"）
  - [ ] grammarPoints 的 explanation 是英文
- [ ] 翻译显示格式
  - [ ] 主翻译：`I don't have enough money.`
  - [ ] 次要翻译：`Chinese: 钱不够。`

#### 测试用例 4：搜索"食べる"
- [ ] 显示本地词典结果
- [ ] 词性标签为英文（如 "Verb"）
- [ ] 定义优先显示英文
- [ ] 例句翻译显示为：`I eat breakfast.`

---

## 二、词典查询功能测试

### 2.1 本地词典查询（收录词汇）

#### 测试用例 5：搜索"行く"
- [ ] 显示词条详情
  - [ ] 标题：行く
  - [ ] 读音：いく [iku]
  - [ ] 词性显示正确
- [ ] 意思部分
  - [ ] 显示多个定义
  - [ ] 中文/英文定义根据系统语言显示
- [ ] 例句部分
  - [ ] 显示 2-3 个例句
  - [ ] 例句有日语原文
  - [ ] 例句有对应翻译
- [ ] 语音功能
  - [ ] 点击标题旁的🔊按钮能播放"行く"的读音
  - [ ] 点击例句旁的��按钮能播放例句

#### 测试用例 6：搜索"お金"
- [ ] 显示词条详情
- [ ] "View More Examples" 按钮显示正确语言
  - [ ] 中文系统："查看更多例句"
  - [ ] 英文系统："View More Examples"
- [ ] 点击"View More Examples"
  - [ ] 显示加载状态（中文："正在整理更多例句…" / 英文："Loading more examples..."）
  - [ ] 成功生成 AI 例句
  - [ ] 例句显示在橙色背景卡片中

### 2.2 AI 查询（未收录词汇）

#### 测试用例 7：搜索"lol"
- [ ] 按回车自动触发 AI 查询
- [ ] 显示顶部警告
  - [ ] 中文："⚠️ 该词条未收录于词典"
  - [ ] 英文："⚠️ Not found in dictionary"
- [ ] **不显示** 搜索框下的 "Not Found" 标签
- [ ] 显示 "AI Suggested Information" 标题
- [ ] 显示完整词条卡片（橙色边框）
  - [ ] 推测的读音：ろる [roru]
  - [ ] 词性：未収録語
  - [ ] 详细解释（英文）："An abbreviation for 'laugh out loud'..."
  - [ ] 例句（如果有）
  - [ ] Related 部分显示同义词
- [ ] **不显示** 底部的 "Above content is AI-generated..." 警告

#### 测试用例 8：搜索"寂静領f"（拼写错误）
- [ ] AI 能识别这是拼写错误
- [ ] 在 Related 的 derived 字段中建议正确形式
- [ ] 提供推测的解释

#### 测试用例 9：搜索"草"（网络俚语）
- [ ] AI 能识别这是网络用语
- [ ] 解释其含义和来源
- [ ] 提供使用例句

### 2.3 句子解析

#### 测试用例 10：搜索"今日は雨が降りそうです。"
- [ ] 自动识别为句子（有句号）
- [ ] 显示 "Sentence Analysis" 标签
- [ ] 显示完整句子解析
  - [ ] Original: 显示原句 + 🔊按钮
  - [ ] Translation: 显示翻译（按系统语言排序）
  - [ ] Word Breakdown: 逐词解析（语言正确）
    - [ ] 每个词显示：词、读音、含义、词性
    - [ ] 含义和词性使用用户语言
  - [ ] Grammar Points: 语法点解释（语言正确）
    - [ ] 显示语法模式
    - [ ] 显示含义和解释
    - [ ] 解释使用用户语言

---

## 三、UI/UX 功能测试

### 3.1 搜索体验

#### 测试用例 11：输入体验
- [ ] 输入时实时搜索本地词典
- [ ] 输入后按回车自动触发 AI
- [ ] 搜索时显示加载动画
- [ ] 结果显示流畅，无卡顿

#### 测试用例 12：AI 按钮
- [ ] 右上角显示蓝色 "AI" 按钮
- [ ] 点击 AI 按钮触发 AI 查询
- [ ] AI 加载时显示进度条

### 3.2 导航和交互

#### 测试用例 13：词条详情页
- [ ] 从搜索结果点击词条能进入详情页
- [ ] 详情页显示标题 "Entry Details"
- [ ] 顶部有返回按钮
- [ ] 所有内容可滚动
- [ ] 语音按钮正常工作

#### 测试用例 14：滚动和布局
- [ ] 搜索结果可以流畅滚动
- [ ] 长句子/定义能正确换行
- [ ] 卡片边距和间距合适
- [ ] 在不同屏幕方向下显示正常

### 3.3 暗黑模式（如果系统开启）

#### 测试用例 15：暗黑模式适配
- [ ] 背景色适配暗黑模式
- [ ] 文字颜色可读
- [ ] 卡片边框可见
- [ ] 橙色警告在暗黑模式下清晰

---

## 四、语音功能测试

### 4.1 TTS（文本转语音）

#### 测试用例 16：单词发音
- [ ] 搜索"こんにちは"
- [ ] 点击标题旁的🔊按钮
- [ ] 听到正确的日语发音
- [ ] 发音速度适中（learner-friendly）
- [ ] 可以重复点击播放

#### 测试用例 17：例句发音
- [ ] 搜索"行く"
- [ ] 点击例句旁的🔊按钮
- [ ] 听到完整例句的发音
- [ ] 发音清晰流畅

---

## 五、缓存和性能测试

### 5.1 缓存功能

#### 测试用例 18：AI 缓存
- [ ] 第一次搜索"お金が足りません"，记录响应时间
- [ ] 第二次搜索相同内容
- [ ] 控制台显示 "✅ Cache HIT"
- [ ] 第二次响应明显更快（<100ms）

#### 测试用例 19：清除缓存
- [ ] 点击 Debug → Clear AI Cache
- [ ] 控制台显示 "🗑️ Clearing all AI caches..."
- [ ] 控制台显示 "✅ All caches cleared (X disk files removed)"
- [ ] 再次搜索显示 "❌ Cache MISS"

### 5.2 性能测试

#### 测试用例 20：快速连续搜索
- [ ] 快速输入多个不同的词
- [ ] 每次搜索都能正确响应
- [ ] 不会出现结果错乱
- [ ] 不会崩溃或卡死

#### 测试用例 21：长时间使用
- [ ] 连续搜索 20+ 个词
- [ ] 内存使用稳定
- [ ] 响应速度没有明显下降
- [ ] 界面流畅

---

## 六、错误处理测试

### 6.1 网络错误

#### 测试用例 22：无网络连接
- [ ] 关闭 WiFi 和蜂窝数据
- [ ] 搜索需要 AI 的内容
- [ ] 显示友好的错误提示
- [ ] 不会崩溃

#### 测试用例 23：网络超时
- [ ] 在弱网环境下测试
- [ ] AI 请求超过 10 秒自动超时
- [ ] 显示超时错误信息

### 6.2 输入边界测试

#### 测试用例 24：空输入
- [ ] 输入框为空时按回车
- [ ] 不会触发搜索
- [ ] 不会显示错误

#### 测试用例 25：特殊字符
- [ ] 搜索 "!@#$%^&*()"
- [ ] AI 能正常处理
- [ ] 不会引起崩溃

#### 测试用例 26：超长输入
- [ ] 输入一段很长的文本（>500字符）
- [ ] AI 能正常处理
- [ ] 结果显示完整

---

## 七、调试功能测试（仅开发模式）

### 7.1 Debug 菜单

#### 测试用例 27：Debug 菜单可访问
- [ ] 右上角显示 "Debug" 按钮
- [ ] 点击能打开菜单
- [ ] 显示所有调试选项

#### 测试用例 28：控制台日志
- [ ] 在 Xcode 中查看控制台
- [ ] 搜索时能看到以下日志：
  - [ ] 🌍 Detected system locale
  - [ ] 🔍 SearchService 日志
  - [ ] 🔑 Cache key calculation
  - [ ] 📤 Sending AI request（如果触发 AI）
  - [ ] 🌍 Building prompt for locale

---

## 八、推荐测试流程

### 快速冒烟测试（5分钟）
1. [ ] 切换到英文系统
2. [ ] 清除 AI 缓存
3. [ ] 搜索 "お金が足りません"（句子解析）
4. [ ] 搜索 "食べる"（本地词典）
5. [ ] 搜索 "lol"（未收录词汇）
6. [ ] 检查所有 UI 标签和内容是否为英文

### 完整功能测试（15-20分钟）
1. [ ] 执行所有 28 个测试用例
2. [ ] 记录任何异常或bug
3. [ ] 截图保存关键界面
4. [ ] 检查控制台是否有错误日志

### 多语言回归测试（10分钟）
1. [ ] 中文系统下测试用例 1、2
2. [ ] 切换到英文系统
3. [ ] 英文系统下测试用例 3、4
4. [ ] 对比两种语言下的显示是否正确

---

## 测试结果记录

### 发现的问题
```
问题 1:
- 描述:
- 重现步骤:
- 预期结果:
- 实际结果:
- 优先级: 高/中/低

问题 2:
...
```

### 测试总结
- 测试日期：
- 测试设备：iPhone 型号 + iOS 版本
- 测试语言：中文 / 英文
- 通过率：X / 28 (XX%)
- 主要问题：
- 建议改进：

---

## 附录：常用测试词汇

### 日语词汇（本地词典）
- 行く（基础动词）
- 食べる（一段动词）
- お金（名词）
- 美しい（い形容词）
- 静か（な形容词）

### 句子（触发句子解析）
- 今日は雨が降りそうです。
- お金が足りません。
- 彼は学校に行きます。

### 未收录词汇（触发 AI）
- lol（网络俚语）
- 草（日本网络用语）
- 推し（流行语）
- 寂静領f（拼写错误测试）

### 边界测试
- 空字符串
- !@#$%（特殊字符）
- あああああああああああああ（长重复）
