# N5例句生成使用指南

## 🚀 快速开始

### 1. 设置Gemini API密钥

```bash
# 临时设置（仅本次会话）
export GEMINI_API_KEY='your-gemini-api-key'

# 或永久设置（添加到 ~/.zshrc 或 ~/.bash_profile）
echo 'export GEMINI_API_KEY="your-gemini-api-key"' >> ~/.zshrc
source ~/.zshrc
```

### 2. 安装依赖

```bash
# 激活虚拟环境（如果有的话）
source ../venv/bin/activate

# 安装必要的包
pip install google-generativeai packaging
```

### 3. 运行脚本

```bash
cd /Users/mac/Maku\ Box\ Dropbox/Maku\ Box/Project/NichiDict/scripts
python3 generate_n5_examples.py
```

---

## 📋 脚本功能

### ✅ 核心功能

1. **断点续传** - 随时中断，下次自动继续
2. **自动提醒** - 完成第1天后创建多种提醒
3. **进度保存** - 实时保存进度到 `.n5_progress.json`
4. **智能限制** - 自动遵守每天500次免费请求限制
5. **质量保证** - 专为N5级别优化的简单例句

### 📊 进度跟踪

脚本会：
- 实时显示进度百分比
- 保存所有已完成的sense ID
- 记录今日使用的请求次数
- 自动检测是否是新的一天

---

## ⏰ 第1天完成后

脚本会自动：

1. ✅ 在桌面创建 `⚠️ 明天继续生成N5例句.txt` 提醒文件
2. ✅ 发送macOS系统通知
3. ✅ 在终端显示醒目提示
4. ✅ 保存完整进度信息

### 明天继续

只需运行**相同的命令**：

```bash
python3 generate_n5_examples.py
```

脚本会：
- ✅ 自动检测到有未完成任务
- ✅ 从上次进度继续
- ✅ 完成剩余的50%

---

## 📈 预期时间线

### 第1天（今天）
- 使用500次免费请求
- 生成约 **2,500个sense** 的例句（50%）
- 实际生成约 **5,000条例句**
- 耗时约 **20-30分钟**

### 第2天（明天）
- 使用约474次免费请求
- 完成剩余 **2,370个sense** 的例句（50%）
- 生成约 **4,740条例句**
- 耗时约 **20分钟**

### 总计
- ✅ **完全免费** - $0成本
- ✅ 总共 **9,740条例句**
- ✅ 覆盖 **4,870个N5词条**

---

## 🛡️ 安全功能

### 断点续传

如果脚本被中断（Ctrl+C、电脑重启、网络断开）：
- ✅ 进度已保存到 `.n5_progress.json`
- ✅ 重新运行脚本将从上次继续
- ✅ 不会重复生成已完成的例句

### 数据安全

- ✅ 每批次完成后立即保存到数据库
- ✅ 进度文件实时更新
- ✅ 不会丢失任何数据

---

## 📊 进度文件说明

`.n5_progress.json` 内容示例：

```json
{
  "completed_sense_ids": [123, 456, 789, ...],
  "total_senses": 4870,
  "total_examples_generated": 2500,
  "requests_today": 500,
  "last_run_date": "2025-10-27",
  "started_at": "2025-10-27T10:00:00"
}
```

### 字段说明

- `completed_sense_ids`: 已完成的sense ID列表
- `total_senses`: N5总sense数
- `total_examples_generated`: 已生成的例句总数
- `requests_today`: 今日已使用的API请求次数
- `last_run_date`: 上次运行日期
- `started_at`: 任务开始时间

---

## 🎯 例句质量标准

### N5级别要求

- ✅ 句子长度：15-25字符
- ✅ 语法：N5级别（です/ます体，现在时、过去时）
- ✅ 场景：日常生活
- ✅ 避免：复杂语法结构（ている、ように、ために等）

### 示例输出

**词汇**：食べる (たべる) - 吃

```json
{
  "examples": [
    {
      "japanese": "朝ごはんを食べます",
      "chinese": "吃早餐",
      "english": "I eat breakfast"
    },
    {
      "japanese": "りんごを食べました",
      "chinese": "吃了苹果",
      "english": "I ate an apple"
    }
  ]
}
```

---

## 🔍 常见问题

### Q: 如果忘记第2天运行怎么办？

**A:** 没关系！随时运行脚本都会从上次进度继续。第3天、第4天运行都可以。

---

### Q: 可以手动停止吗？

**A:** 可以！按 `Ctrl+C` 停止，进度会自动保存。下次运行继续。

---

### Q: 如果网络中断怎么办？

**A:** 脚本会显示错误，但已完成的进度已保存。重新运行即可继续。

---

### Q: 如何查看当前进度？

**A:** 运行脚本，它会自动显示：
```
📊 任务状态：
   - 总sense数：4870
   - 已完成：2500
   - 待处理：2370
```

---

### Q: 如何重新开始？

**A:** 删除进度文件：
```bash
rm .n5_progress.json
python3 generate_n5_examples.py
```

---

### Q: 生成的例句保存在哪里？

**A:** 直接保存到数据库：
```
../NichiDict/Resources/seed.sqlite
表: example_sentences
```

---

## 🎨 终端输出示例

```
============================================================
📚 N5例句生成脚本（Gemini 2.5 Flash-Lite 免费版）
============================================================

📊 任务状态：
   - 总sense数：4870
   - 已完成：0
   - 待处理：4870
   - 今日已用额度：0/500
   - 今日可处理：2500 个sense
   - 预计时间：20.8 分钟

⚠️  准备开始生成，将使用 500 次API请求
   按 Ctrl+C 取消，或等待 3 秒自动开始...

🤖 初始化 Gemini 2.5 Flash-Lite...

🔄 开始生成例句...

📦 批次 1/500 (sense 1-5/2500)
    ✅ 食べる (たべる): 2 例句
    ✅ 行く (いく): 2 例句
    ✅ 見る (みる): 2 例句
    ✅ 聞く (きく): 2 例句
    ✅ 話す (はなす): 2 例句
   💾 已保存 5 个词条的例句
   📈 总进度: 0.1% (5/4870)

📦 批次 2/500 (sense 6-10/2500)
    ✅ 書く (かく): 2 例句
    ...

============================================================
✅ 今日任务完成！已生成 2500/4870 (51.3%)
============================================================
📊 进度详情：
   - 剩余sense：2370
   - 已生成例句：5000 条
   - 今日请求数：500/500

📅 明天继续：
   python3 generate_n5_examples.py

💡 脚本会自动从进度继续，无需担心！
============================================================

📝 已创建桌面提醒文件：/Users/mac/Desktop/⚠️ 明天继续生成N5例句.txt
```

---

## 🎁 完成后

当全部4,870个sense完成后：

```
============================================================
🎉 恭喜！N5例句生成任务完成！
============================================================
✅ 总共生成：9740 条例句
✅ 覆盖词条：4870 个sense
✅ 总用时：0.7 小时
============================================================
```

脚本会自动：
- ✅ 清理进度文件
- ✅ 删除桌面提醒文件
- ✅ 发送完成通知

---

## 🔧 高级选项

### 修改配置

编辑脚本文件 `generate_n5_examples.py`：

```python
# 修改每批处理数量（默认5）
BATCH_SIZE = 5

# 修改每个sense的例句数（默认2）
EXAMPLES_PER_SENSE = 2

# 修改每日请求限制（默认500）
MAX_DAILY_REQUESTS = 500
```

---

## 📞 需要帮助？

如果遇到问题：

1. 检查API密钥是否正确设置
2. 查看进度文件 `.n5_progress.json`
3. 检查数据库连接
4. 查看错误信息并搜索解决方案

### 常见错误解决

#### 错误：ModuleNotFoundError: No module named 'packaging'

**原因**：google-generativeai 的依赖项未完全安装

**解决方法**：
```bash
# 在虚拟环境中安装 packaging
source ../venv/bin/activate
pip install packaging
```

#### 错误：ModuleNotFoundError: No module named 'google.generativeai'

**原因**：SDK未安装或虚拟环境未激活

**解决方法**：
```bash
# 确保在虚拟环境中
source ../venv/bin/activate

# 安装SDK和依赖
pip install google-generativeai packaging
```

---

**创建时间**：2025-10-27
**版本**：1.0
**作者**：Claude Code